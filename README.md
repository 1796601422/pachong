# 知乎内容爬虫

一个基于 Vue.js + Node.js + Puppeteer 的知乎问题及回答爬取工具。

## 项目特点

- 采用三层分离架构：前端 (Vue) + 服务端 (Node.js) + 无头浏览器 (Puppeteer)
- 通过模拟真实浏览器环境，有效绕过反爬机制
- 使用用户提供的 Cookie 进行访问，无需处理复杂的登录流程
- 支持无限滚动，获取问题下的所有回答
- 支持关键词搜索，快速找到相关问题
- 清洗 HTML，提供干净的纯文本内容
- 美观的用户界面，包含水印和统计信息展示
- 爬取过程实时可视化，直观展示爬取进度

## 技术栈

- **前端**：Vue 3 + Element Plus
- **后端**：Express.js
- **爬虫**：Puppeteer + StealthPlugin

## 安装与运行

### 环境要求

- Node.js 14.x 或更高版本
- 安装了 Microsoft Edge 或 Google Chrome 浏览器

### 安装依赖

```bash
# 安装所有依赖（包括前后端）
npm run install-all
```

### 开发模式

```bash
# 同时启动前端和后端服务
npm run dev-all

# 或分别启动
npm run dev  # 启动后端服务
npm run client  # 启动前端开发服务器
```

### 构建与部署

```bash
# 构建前端资源
cd client
npm run build

# 启动生产服务
cd ..
npm start
```

## 使用方法

### 关键词搜索

1. 启动应用后，访问 `http://localhost:5173`（开发模式）或 `http://localhost:3000`（生产模式）
2. 在首页的搜索框中输入关键词，点击「搜索」按钮
3. 查看搜索结果列表，包含问题标题、描述、关注数和回答数
4. 可以使用排序功能按回答数或关注数排序
5. 点击感兴趣的问题进入问题详情页，系统会自动爬取该问题的所有回答

### 回答爬取

1. 点击导航栏中的「回答爬取」进入爬取页面
2. 在首页点击「设置 Cookie」按钮，并按照提示设置知乎 Cookie
3. 在输入框中输入知乎问题链接（例如：`https://www.zhihu.com/question/12345678`）
4. 点击「开始爬取」按钮，等待数据爬取完成
   - 爬取过程中可以看到实时进度条和状态更新
   - 进度条显示当前爬取阶段、已发现回答数和滚动次数
5. 查看并使用爬取到的问题和回答数据，包含统计信息和可视化展示

### 账号登录

1. 点击页面右上角的「账号登录」按钮
2. 在弹出的登录对话框中输入手机号
3. 点击「获取验证码」按钮，系统会向您的手机发送验证码
4. 如果遇到滑动验证码：
   - 系统会自动尝试破解滑动验证码
   - 如果自动破解成功，将继续发送验证码流程
   - 如果自动破解失败，系统会显示浏览器窗口供您手动完成验证
5. 输入收到的验证码
6. 点击「继续登录」按钮
7. 如果登录过程中再次遇到验证码，系统也会尝试自动破解
8. 登录成功后，系统会自动获取并保存Cookie用于后续爬取操作

### 手动设置Cookie

如果您不想使用账号密码登录，也可以手动设置Cookie：

1. 点击页面右上角的「手动设置Cookie」按钮
2. 在浏览器中登录知乎
3. 按F12打开开发者工具，切换到「网络(Network)」面板
4. 刷新页面，点击任意zhihu.com请求
5. 在「请求头」中找到并复制cookie的值
6. 将复制的cookie粘贴到对话框中，点击「保存」按钮

## 注意事项

- 本工具仅供学习研究使用，请勿用于商业目的
- 请遵守知乎用户协议，尊重知乎及创作者的权益
- 频繁使用可能导致您的知乎账号被限制，请谨慎使用

## 项目结构

```
zhihu-scraper/
├── client/                # 前端项目
│   ├── public/            # 静态资源
│   └── src/               # 源代码
│       ├── components/    # 组件
│       ├── views/         # 页面
│       ├── App.vue        # 根组件
│       ├── main.js        # 入口文件
│       └── router/        # 路由配置
├── server.js              # 后端入口文件
├── package.json           # 项目依赖
└── README.md              # 项目说明
```

## 许可证

MIT 

## 会话记录

### 2023-11-XX 项目启动

**会话目的**：运行知乎爬虫项目

**完成的主要任务**：
- 安装前后端依赖
- 启动前端和后端服务

**关键决策和解决方案**：
- 使用`npm run install-all`命令安装所有依赖
- 使用`npm run dev-all`命令同时启动前端和后端服务

**使用的技术栈**：
- 前端：Vue 3 + Element Plus + Vite
- 后端：Express.js
- 爬虫：Puppeteer + StealthPlugin

**修改的文件**：
- 无文件修改，仅启动项目服务

### 2023-12-XX 项目重新运行

**会话目的**：重新运行知乎爬虫项目

**完成的主要任务**：
- 安装依赖并启动前端和后端服务
- 确认服务正常运行
- 更新项目文档

**关键决策和解决方案**：
- 分别启动后端服务（端口3000）和前端服务（端口5173）
- 解决PowerShell中命令执行问题
- 确认服务正常运行并可访问

**使用的技术栈**：
- 前端：Vue 3 + Vite（端口5173）
- 后端：Node.js + Express（端口3000）
- 爬虫：Puppeteer + StealthPlugin

**修改的文件**：
- README.md（更新项目运行说明）

### 2023-11-XX 添加关键词搜索功能

**会话目的**：为知乎爬虫项目添加关键词搜索功能

**完成的主要任务**：
- 实现知乎问题关键词搜索功能
- 搜索结果展示及分页功能
- 从搜索结果直接跳转到问题爬取页面

**关键决策和解决方案**：
- 服务端添加`/api/search-questions`接口，使用Puppeteer模拟搜索行为
- 前端添加专门的搜索页面
- 实现搜索结果到问题爬取的无缝跳转

**使用的技术栈**：
- 前端：Vue 3 + Vue Router + Element Plus
- 后端：Express.js
- 爬虫：Puppeteer

**修改的文件**：
- server.js：添加关键词搜索API接口
- client/src/views/Search.vue：新建搜索页面组件
- client/src/App.vue：添加导航菜单
- client/src/router/index.js：添加搜索页面路由
- client/src/views/Home.vue：支持URL参数自动爬取
- README.md：更新项目文档

### 2023-11-XX 修复关键词搜索功能

**会话目的**：修复关键词搜索功能无法返回结果的问题

**完成的主要任务**：
- 解决搜索功能因知乎页面结构变化导致无法获取结果的问题
- 增强选择器的适应性和健壮性
- 提升用户体验，添加更多的错误处理和提示

**关键决策和解决方案**：
- 使用多种CSS选择器尝试匹配知乎最新页面结构
- 添加失败时的调试信息和页面截图功能
- 前端增加友好的错误提示和重试功能

**使用的技术栈**：
- 前端：Vue 3 + Element Plus
- 后端：Express.js
- 爬虫：Puppeteer + 多层选择器策略

**修改的文件**：
- server.js：更新搜索API接口的选择器和匹配逻辑
- client/src/views/Search.vue：增强错误处理和用户体验
- client/src/views/Home.vue：优化URL参数处理
- README.md：更新修复记录

### 2023-11-XX 完善搜索功能的回答数显示

**会话目的**：完善关键词搜索功能中的回答数量显示

**完成的主要任务**：
- 增强回答数和关注数的视觉展示效果
- 添加按回答数和关注数排序功能
- 改进搜索结果与问题详情页面的导航体验
- 优化从问题详情返回搜索页面的状态恢复功能

**关键决策和解决方案**：
- 使用颜色编码直观表示回答数量（高、中、低）
- 实现对搜索结果的灵活排序
- 增加导航提示和返回功能，提升用户体验
- 使用路由参数保存搜索状态，实现无缝导航

**使用的技术栈**：
- 前端：Vue 3 + Element Plus + Vue Router
- 后端：Express.js + 增强的HTML解析
- 爬虫：Puppeteer + 改进的数据提取算法

**修改的文件**：
- server.js：增强回答数和关注数的提取逻辑
- client/src/views/Search.vue：添加排序功能和视觉增强
- client/src/views/Home.vue：优化URL参数处理
- README.md：更新功能说明

### 2024-05-XX 快速启动项目

**会话目的**：快速启动知乎爬虫系统

**完成的主要任务**：
- 安装前后端依赖
- 分别启动后端服务（端口3000）和前端服务（端口5173）
- 确认服务正常运行

**关键决策和解决方案**：
- 使用`npm run install-all`命令安装所有依赖
- 分别使用`npm run dev`和`npm run client`命令启动后端和前端服务
- 通过网络端口检查确认服务正常运行

**使用的技术栈**：
- 前端：Vue 3 + Element Plus + Vite（端口5173）
- 后端：Node.js + Express（端口3000）
- 爬虫：Puppeteer + StealthPlugin

**修改的文件**：
- README.md（更新项目运行记录）
